---
title: "Project 11"
author: "Ellen Hickman, Mi Huynh"
date: "2025-11-29"
output: pdf_document
editor_options: 
  chunk_output_type: console
  markdown: 
    wrap: 72
---

## Use rats data in faraway.
```{r}
library(faraway)
library(ggplot2)
library(dplyr)
library(janitor)
data(rats)
head(rats)
```
## 1. (THIS IS THE SAME AS #1 of PROJECT 10. NO NEED TO REWORK. JUST USE THE OBSERVATIONS FOR #2 IN PROJECT 11.) Focus on time as the response and treat as the predictor. Plot time as a function of treat using a jittered scatter plot. Add a mean of time for each level of treat to the plot. What pattern do you see? Describe this in laymanâ€™s terms.
```{r}
means <- aggregate(time~treat, rats, mean)
ggplot(rats, aes(x = treat, y = time)) +
  geom_point(position = position_jitter(width = 0.1)) +
  stat_summary(fun = mean, geom = "point", colour = "red") +
  geom_text(
    data = means,
    aes(label = round(time, 2), y = time + 0.1),
    color = "red",
    show.legend = FALSE
  ) +
  labs(
    title = "Survival Time by Treatment Type",
    x = "Treatment Type",
    y = "Survival Time (tens of hours)"
  ) +
  theme_minimal()
```
-  The treatement groups B has the highest average survival time (~ 7 hours until death), however shows the most spread compared to the other treatments. Treatment A shows the lowest average survival time (~ 3 hours until death) also with the least amount of variance. The middling treatments C and D have similar average survival times (~ 5 hours until death) with treatment D with similar variances.

## 2. Examine time as the response and treat and poison as the predictors through a jittered scatter plot as done in #1 from Project 10 with an addition of lines that show the mean of time at the interaction of poison and treat. Does the pattern seen in #1 from Project 10 hold across all poison types?
```{r}
means2 <- aggregate(time~treat+poison, rats, mean)
ggplot(rats, aes(x = treat, y = time)) +
  geom_point(position = position_jitter(width = 0.1)) +
  stat_summary(fun = mean, geom = "point", color="red",size=2)+
  stat_summary(fun = mean, geom = "line", 
             aes(group = poison, linetype = poison)) +
  labs(
    title = "Survival Time by Treatment Type and Poison Type",
    x = "Treatment Type",
    y = "Survival Time (tens of hours)"
  ) +
  theme_minimal()
```
-  The pattern seen in #1 from Project 10 does not hold across all poison types.
-  For poison type I, the change from Treatment Type C and D on survival times does not reflect the overall change from C to D seen in #1 from Project 10 (it's smaller/more marginal). 
-  For poison type II, treatment D has a much higher average survival time compared to the other treatments, which is not observed in poison types I and III.
- Additionally, the effects on survival time for poison type II and treatment B is higher than the overall pattern of means.
- For poison type III, treatment B shows an lower average survival time for treatment B compared to the overall pattern of means. 

## 3. Model time on treat, poison and their interaction in a linear regression. What do the coefficient estimates of interactions indicate? How does this correspond to your observation in #2?
```{r}
aov(time~treat+poison+treat*poison,rats)
summary(lm(time~treat*poison,rats)) # * indicates interaction including main effects
```
- The coefficient estimates of interactions indicate how much the effect of one predictor (treat) on the response variable (time) changes depending on the level of the other predictor (poison), compared to the baseline levels (treat A and poison I) in the main effects + interaction model.
- Holding the main effects of treatment and poison constant, rats who underwent treatment B and poison III showed a significant decrease in survival time of 3.4 hours compared to the baseline group (treatment A and poison I). 
- In observation #2, we did notice that treatment B poison III had a lower average survival time compared to the overall pattern of means, which is consistent with the negative interaction coefficient observed in the model, compared to the baseline group (treatment A and poison I).

## 4. Check whether linear model assumptions hold for the model in #3. Describe what these assumptions are and whether they are met.
# zero mean assumption of residuals
```{r}
lm <- lm(time~treat*poison,rats)
mean(lm$resid)
plot(density(resid(lm)), main="Density Plot")
hist(resid(lm))
```
- The zero mean assumption states that the average of the residuals (the differences between observed and predicted values) should be zero. In our model, the density and histogram plots show that the mean of the residuals is approximately 0 (very close to zero), indicating that this assumption is met.
# homoscedasticity
```{r,fig.width=4, fig.height=4}
plot(fitted(lm),resid(lm)) # estimated y vs residuals
abline(h=0,col="blue")
```
- The homoscedasticity assumption states that the variance of the residuals should be constant across all levels of the predicted values. In our model, the scatter plot of residuals versus fitted values shows a funnel shape, indicating that the spread of the residuals increases as the fitted values increase. This suggests that the homoscedasticity assumption may be violated.
# normality of errors
```{r}
qqnorm(lm$resid);qqline(lm$resid)
```
- The normality assumption states that the residuals should be normally distributed. In our model, the QQ plot shows that the residuals deviate from the straight line, especially at the tails, indicating that the normality assumption may be violated.
## 5. Address the problem identified in #4 through a transformation of the response variable. Describe the transformation used and discuss whether this is effective for addressing the assumption violations.

## 6. Compare which pairs of treat produce different time under the model in #3 and under the model in #5. What do you observe?

## 7. Now, focus on time as a result of treat. Use treat as a random factor and interpret the effect of treat on time.
